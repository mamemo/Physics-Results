<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Prompt Video Matrix</title>
		<style>
			:root {
				--bg: #0b0e13;
				--card: #121722;
				--muted: #9aa4b2;
				--text: #e9eef5;
				--accent: #7bc4ff;
				--grid: #1b2230;
				--btn: #1a73e8;
				--btnText: #fff;
			}
			[data-theme="light"] {
				--bg: #f6f7fb;
				--card: #ffffff;
				--muted: #64748b;
				--text: #0f172a;
				--accent: #0ea5e9;
				--grid: #e5e7eb;
				--btn: #0ea5e9;
				--btnText: #fff;
			}
			* {
				box-sizing: border-box;
			}
			body {
				margin: 0;
				font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI,
					Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
				background: var(--bg);
				color: var(--text);
			}
			header {
				position: sticky;
				top: 0;
				z-index: 20;
				backdrop-filter: saturate(140%) blur(8px);
				background: color-mix(in oklab, var(--bg) 80%, transparent);
				border-bottom: 1px solid var(--grid);
			}
			.wrap {
				max-width: 1200px;
				margin: 0 auto;
				padding: 16px 20px;
			}
			h1 {
				margin: 0;
				font-size: 20px;
				font-weight: 700;
				letter-spacing: 0.2px;
			}
			.sub {
				color: var(--muted);
				font-size: 13px;
				margin-top: 6px;
			}
			.control-bar {
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
				align-items: center;
				margin-top: 12px;
			}
			button,
			.chip {
				appearance: none;
				border: none;
				background: var(--btn);
				color: var(--btnText);
				padding: 8px;
				border-radius: 50%;
				width: 44px;
				height: 44px;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);
				transition: 0.2s transform;
				font-size: 18px;
			}
			button:hover {
				transform: translateY(-1px);
			}
			.chip {
				background: transparent;
				color: var(--muted);
				border: 1px solid var(--grid);
				border-radius: 12px;
				width: auto;
				height: auto;
				padding: 8px 12px;
				font-size: 14px;
			}
			.grid {
				overflow: auto;
				padding: 20px;
			}
			table {
				width: max(800px, 100%);
				border-collapse: separate;
				border-spacing: 0;
				table-layout: fixed;
			}
			thead th {
				position: sticky;
				top: 0;
				background: var(--card);
				z-index: 10;
				border-bottom: 1px solid var(--grid);
				font-size: 12px;
				text-transform: uppercase;
				letter-spacing: 0.06em;
				color: var(--muted);
				padding: 10px;
			}
			thead th:first-child {
				left: 0;
				position: sticky;
				z-index: 11;
				text-align: left;
				background: var(--card);
			}
			tbody th {
				position: sticky;
				left: 0;
				background: var(--card);
				border-right: 1px solid var(--grid);
				text-align: left;
				padding: 10px;
				font-size: 14px;
				vertical-align: top;
				width: 260px;
			}
			td {
				padding: 10px;
				border-bottom: 1px solid var(--grid);
				background: var(--card);
				width: 260px;
			}
			.cell {
				display: flex;
				flex-direction: column;
				gap: 8px;
			}
			video {
				width: 100%;
				height: 150px;
				background: #000;
				border-radius: 12px;
				border: 1px solid var(--grid);
				display: block;
			}
			.row-controls {
				display: flex;
				gap: 12px;
				flex-wrap: wrap;
				margin-top: 12px;
				justify-content: center;
			}
			.tag {
				font-size: 12px;
				color: var(--muted);
			}
			.note {
				color: var(--muted);
				font-size: 12px;
				margin-top: 12px;
			}
			.footer {
				color: var(--muted);
				font-size: 12px;
				text-align: center;
				padding: 18px;
			}
			@media (max-width: 900px) {
				td,
				tbody th {
					width: 220px;
				}
				video {
					height: 124px;
				}
			}
			@media (max-width: 700px) {
				td,
				tbody th {
					width: 180px;
				}
				video {
					height: 102px;
				}
			}
		</style>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
			integrity="sha512-SnH5WK+bZxgPHs44uWIX+2dvNhbbX6YsJhBKt3vnDnN/SUXOc6Bx/OVCkXbklaVK+FkB1hp5qC9fM6VQm8K4iw=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>
	</head>
	<body>
		<header>
			<div class="wrap">
				<h1>Prompt Video Matrix</h1>
				<div class="sub">
					Each folder in <code>assets/</code> is a prompt folder. It
					must contain <code>prompt.txt</code> and the 5 videos
					(<code>cogvideox.mp4</code>, <code>motion.mp4</code>,
					<code>collisions.mp4</code>, <code>motion_desc.mp4</code>,
					<code>collisions_desc.mp4</code>).
				</div>
				<div class="control-bar">
					<button id="muteAll" title="Mute all">
						<i class="fas fa-volume-mute"></i>
					</button>
					<button id="pauseAll" title="Pause all">
						<i class="fas fa-pause"></i>
					</button>
					<button id="resetAll" title="Reset all">
						<i class="fas fa-rotate-left"></i>
					</button>
					<span class="chip"
						>Theme:
						<button
							id="toggleTheme"
							class="chip"
							style="margin-left: 6px"
						>
							Toggle
						</button></span
					>
				</div>
			</div>
		</header>

		<main class="wrap grid">
			<table id="matrix">
				<thead>
					<tr id="headRow"></tr>
				</thead>
				<tbody id="body"></tbody>
			</table>
			<p class="note">
				The site automatically scans the <code>assets/</code> folder and
				treats every subfolder as a prompt. Each folder should have
				<code>prompt.txt</code> with text to show in the first column,
				plus the five videos with fixed names.
			</p>
		</main>

		<div class="footer">
			Built for GitHub Pages. No manifest.json needed — just folders in
			<code>assets/</code>.
		</div>

		<script src="assets/prompts.js"></script>
		<script>
			const COLUMNS = [
				{ key: "cogvideox", label: "CogVideoX" },
				{ key: "motion", label: "Motion‑only" },
				{ key: "collisions", label: "Collisions" },
				{ key: "motion_desc", label: "Motion‑only (descriptive)" },
				{
					key: "collisions_desc",
					label: "Collisions (text‑descriptive)",
				},
			];

			const headRow = document.getElementById("headRow");
			const body = document.getElementById("body");

			headRow.appendChild(document.createElement("th")).textContent =
				"Prompt";
			for (const col of COLUMNS) {
				const th = document.createElement("th");
				th.textContent = col.label;
				headRow.appendChild(th);
			}

			async function loadText(url) {
				const res = await fetch(url);
				if (!res.ok) throw new Error("Missing " + url);
				return await res.text();
			}

			function makeVideo(src, id) {
				const v = document.createElement("video");
				v.controls = true;
				v.preload = "metadata";
				v.playsInline = true;
				v.muted = true;
				v.src = src;
				v.dataset.vid = id;
				return v;
			}

			function queryRowVideos(rowId) {
				return Array.from(
					document.querySelectorAll(`video[data-vid^="${rowId}-"]`)
				);
			}

			async function playAll(videos) {
				for (const v of videos) {
					try {
						v.currentTime = 0;
						await v.play();
					} catch (e) {}
				}
			}
			function pauseAll(videos) {
				videos.forEach((v) => v.pause());
			}
			function resetAllVideos(videos) {
				videos.forEach((v) => {
					v.pause();
					v.currentTime = 0;
				});
			}
			function setAllMuted(m) {
				document
					.querySelectorAll("video")
					.forEach((v) => (v.muted = m));
			}

			async function buildFromAssets() {
				let promptFolders = window.promptFolders || [];
				if (!promptFolders.length)
					promptFolders = [
						/* "p1","p2" */
					];

				for (let i = 0; i < promptFolders.length; i++) {
					const id = promptFolders[i];
					const title = `Prompt ${i + 1}`;

					const tr = document.createElement("tr");

					const th = document.createElement("th");
					th.innerHTML = `<div>\
        <div><strong>${title}</strong></div>\
        <div class=\"tag\">Row ${i + 1}</div>\
        <div class=\"tag\" id=\"${id}-promptText\" style=\"white-space:pre-wrap\"></div>\
        <div class=\"row-controls\">\
          <button class=\"playRow\" data-row=\"${id}\" title=\"Play row (sync)\"><i class=\"fa-solid fa-play\"></i></button>\
          <button class=\"pauseRow\" data-row=\"${id}\" title=\"Pause row\"><i class=\"fas fa-pause\"></i></button>\
          <button class=\"resetRow\" data-row=\"${id}\" title=\"Reset row\"><i class=\"fas fa-rotate-left\"></i></button>\
        </div>\
      </div>`;
					tr.appendChild(th);

					for (const col of COLUMNS) {
						const td = document.createElement("td");
						const container = document.createElement("div");
						container.className = "cell";
						const src = `assets/${id}/${col.key}.mp4`;
						const v = makeVideo(src, `${id}-${col.key}`);
						container.appendChild(v);
						td.appendChild(container);
						tr.appendChild(td);
					}
					body.appendChild(tr);

					loadText(`assets/${id}/prompt.txt`)
						.then((t) => {
							const el = document.getElementById(
								`${id}-promptText`
							);
							if (el) el.textContent = t.trim();
						})
						.catch(() => {
							const el = document.getElementById(
								`${id}-promptText`
							);
							if (el) el.textContent = "(no prompt.txt)";
						});
				}

				document.querySelectorAll(".playRow").forEach((btn) =>
					btn.addEventListener("click", async (e) => {
						await playAll(
							queryRowVideos(e.currentTarget.dataset.row)
						);
					})
				);
				document.querySelectorAll(".pauseRow").forEach((btn) =>
					btn.addEventListener("click", (e) => {
						pauseAll(queryRowVideos(e.currentTarget.dataset.row));
					})
				);
				document.querySelectorAll(".resetRow").forEach((btn) =>
					btn.addEventListener("click", (e) => {
						resetAllVideos(
							queryRowVideos(e.currentTarget.dataset.row)
						);
					})
				);

				document.querySelectorAll("video").forEach((v) => {
					v.addEventListener("ended", () => {
						const [rowId] = v.dataset.vid.split("-");
						pauseAll(queryRowVideos(rowId));
					});
				});
			}

			document
				.getElementById("muteAll")
				.addEventListener("click", () => setAllMuted(true));
			document
				.getElementById("pauseAll")
				.addEventListener("click", () =>
					pauseAll(Array.from(document.querySelectorAll("video")))
				);
			document
				.getElementById("resetAll")
				.addEventListener("click", () =>
					resetAllVideos(
						Array.from(document.querySelectorAll("video"))
					)
				);

			const root = document.documentElement;
			const saved = localStorage.getItem("pv-theme");
			if (saved) {
				root.setAttribute("data-theme", saved);
			}
			document
				.getElementById("toggleTheme")
				.addEventListener("click", () => {
					const cur = root.getAttribute("data-theme");
					const next = cur === "light" ? "dark" : "light";
					root.setAttribute("data-theme", next);
					localStorage.setItem("pv-theme", next);
				});

			buildFromAssets();
		</script>
	</body>
</html>
